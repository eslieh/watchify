<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />

  <!-- Favicon -->
  <link rel="icon" href="%PUBLIC_URL%/favicon.png" />
  <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />

  <!-- Manifest file for web app installation -->
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />

  <title>Watchify</title>

  <!-- Preconnect to optimize loading fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Font import -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

  <!-- External CSS -->
  <link rel="stylesheet" href="./style.css">

  <!-- FontAwesome for Icons -->
  <script src="https://kit.fontawesome.com/e6755db976.js" crossorigin="anonymous"></script>
</head>

<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root"></div>

  <script>
    // Function to create meta tags
    function createMetaTag(attr, content) {
      const meta = document.createElement('meta');
      for (const key in attr) {
        meta.setAttribute(key, attr[key]);
      }
      meta.setAttribute('content', content);
      document.head.appendChild(meta);
    }

    // Function to fetch dynamic meta data
    async function fetchDynamicMetaData(type, id) {
      try {
        const baseUrl = 'https://api.themoviedb.org/3/';
        const apiKey = '589f8d3ada4c0c32b6db7671025e3162';
        let url;

        if (type === 'tv') {
          url = `${baseUrl}tv/${id}?api_key=${apiKey}`;
        } else if (type === 'movie') {
          url = `${baseUrl}movie/${id}?api_key=${apiKey}`;
        }

        const response = await fetch(url);
        const data = await response.json();

        const title = data.name || data.title || 'Watchify';
        const description = data.overview || 'Stream your favorite movies and TV shows anytime, anywhere.';
        const imageUrl = `https://image.tmdb.org/t/p/w500${data.poster_path}`;
        const pageUrl = `https://watchifyy.vercel.app/${type}/${id}`;

        // Set the page title
        document.title = title;

        // SEO Meta Tags
        createMetaTag({ name: 'description' }, description);
        createMetaTag({ name: 'keywords' }, 'movies, streaming, subscription, no ads, offline downloads, HD streaming, Watchify');
        createMetaTag({ name: 'author' }, 'Eslieh Victor');
        createMetaTag({ name: 'google-site-verification' }, 'qKCxEt02GiLWqQSWWG9Xsxqlly8pMtglfugY-L-L8LE');

        // Open Graph Meta Tags
        createMetaTag({ property: 'og:title' }, title);
        createMetaTag({ property: 'og:description' }, description);
        createMetaTag({ property: 'og:image' }, imageUrl);
        createMetaTag({ property: 'og:url' }, pageUrl);
        createMetaTag({ property: 'og:type' }, 'website');
        createMetaTag({ property: 'og:locale' }, 'en_US');

        // Twitter Card Meta Tags
        createMetaTag({ name: 'twitter:card' }, 'summary_large_image');
        createMetaTag({ name: 'twitter:title' }, title);
        createMetaTag({ name: 'twitter:description' }, description);
        createMetaTag({ name: 'twitter:image' }, imageUrl);

      } catch (error) {
        console.error('Error fetching dynamic meta data:', error);
      }
    }

    // Function to check URL and create meta tags
    function setMetaTags() {
      const path = window.location.pathname;

      if (path.includes('/tv/')) {
        const id = path.split('/tv/')[1];
        fetchDynamicMetaData('tv', id);
      } else if (path.includes('/movie/')) {
        const id = path.split('/movie/')[1];
        fetchDynamicMetaData('movie', id);
      } else {
        // Default Meta Tags for Home Page or Other Pages
        document.title = 'Watchify - Stream Movies and TV Shows';
        createMetaTag({ name: 'description' }, 'Watchify offers affordable subscription plans with no ads, offline downloads, and HD streaming on multiple devices.');
        createMetaTag({ name: 'keywords' }, 'movies, streaming, subscription, no ads, offline downloads, HD streaming, Watchify');
        createMetaTag({ name: 'author' }, 'Eslieh Victor');

        // Default Open Graph Meta Tags
        createMetaTag({ property: 'og:title' }, 'Watchify - Stream Movies and TV Shows');
        createMetaTag({ property: 'og:description' }, 'Watchify offers affordable subscription plans with no ads, offline downloads, and HD streaming on multiple devices.');
        createMetaTag({ property: 'og:image' }, 'https://watchifyy.vercel.app/default-image.png');
        createMetaTag({ property: 'og:url' }, 'https://watchifyy.vercel.app');
        createMetaTag({ property: 'og:type' }, 'website');

        // Default Twitter Card Meta Tags
        createMetaTag({ name: 'twitter:card' }, 'summary_large_image');
        createMetaTag({ name: 'twitter:title' }, 'Watchify - Stream Movies and TV Shows');
        createMetaTag({ name: 'twitter:description' }, 'Watchify offers affordable subscription plans with no ads, offline downloads, and HD streaming on multiple devices.');
        createMetaTag({ name: 'twitter:image' }, 'https://watchifyy.vercel.app/default-image.png');
      }
    }

    // Call the function on page load
    window.onload = setMetaTags;
  </script>
</body>

</html>
